!function(e,n){"undefined"!=typeof module&&module.exports?module.exports=n(require("elliptical-utils"),require("component-extensions").template):"function"==typeof define&&define.amd?define(["elliptical-utils","component-extensions"],n):(e.elliptical=e.elliptical||{},e.elliptical.binding=n(e.elliptical.utils,elliptical.extensions.template),e.returnExports=e.elliptical.binding)}(this,function(e,n){function t(){$(document).on("OnDocumentMutation",function(e,n){n.added&&l(n.added),n.removed&&r(n.removed)})}function o(e,n){d||t(),d=!0;var o=g.obj;o.fn=n,o.context=this,m.set(e,o),this.click="touchclick",this._events=[]}function l(e){m.forEach(function(n,t){var o=$(e).selfFind("["+p+'="'+t+'"]');o[0]&&$.each(o,function(e,o){var l=f.id(8);o._EA_BINDING_ID=l;var r=y.obj;r.node=o,r.context=n.context,r.attrValue=t,r.fn=n.fn,h.set(l,r),i(n.context,o,n.fn)})})}function i(e,n,t){setTimeout(function(){t.call(e,n)},v)}function r(e){var n=$(e).selfFind(s);n.length&&n.length>0&&$.each(n,function(e,n){n._EA_BINDING_ID&&c(n)})}function c(e){var n=e._EA_BINDING_ID,t=h.get(n);void 0===t?u(e):a(t,e)}function a(e,n){e.context.unbindEvents(),e.context.onDestroy(),e.context=null,n&&n.parentNode&&n.parentNode.removeChild(n),e.fn=null,e.node=null,h["delete"](key)}function u(e){h.forEach(function(n,t){e===t.node&&a(t,e)})}n.template&&(n=n.template);var f=e.random,s="[ea-bind]",p="ea-bind",d=!1,v=500,m=new Map,h=new Map,g={get obj(){return{fn:null,context:null}}},y={get obj(){return{node:null,context:null,fn:null,attrValue:null}}};return $(function(){var e=document.querySelectorAll(s);e.length&&l(e)}),o.prototype.jsonParseMessage=function(e){try{var n=JSON.parse(e);return n.message?n.message:e}catch(t){return e}},o.prototype.render=function(e,t,o,l){n._render(e,t,o,l)},o.prototype.renderTemplate=function(e,t,o){n._renderTemplate(e,t,function(e,n){e||(n=$.parseHTML(n,document,!0)),o&&o(e,n)})},o.prototype.renderTemplateString=function(e,t,o){n._renderTemplateString(e,t,o)},o.prototype.preload=function(e,n){var t=[],o={},l=$(e),i=l.find("img"),r=i.length,c=0;return 0===r?(n&&n(null),!1):($.each(i,function(e,l){var i=new Image;$(i).bind("load",function(e){c++,t.push(i),c===r&&n&&(o.images=t,o.length=c,n(o))}),i.src=l.src}),!0)},o.prototype.load=function(e,n){var t=new Image;t.onload=function(){n(this)},t.src=e},o.prototype.component=function(e,n,t){if(e[n])return t(e[n].bind(e));var o=0,l=20,i=setInterval(function(){e[n]?(clearInterval(i),t(e[n].bind(e))):l>o?o++:(clearInterval(i),t(e[n].bind(e)))},300)},o.prototype.onDestroy=function(){},o.prototype.event=function(e,n,t,o){var l={};l.element=e,l.event=n;var i=arguments.length;3===i&&(o="function"==typeof t?t:null,t=null),l.selector=t,l.callback=o;var r=this._events;-1===$.inArray(l,r)&&this._events.push(l),t?e.on(n,t,function(){var e=[].slice.call(arguments);o&&o.apply(this,e)}):e.on(n,function(){var e=[].slice.call(arguments);o&&o.apply(this,e)})},o.prototype.unbindEvents=function(){for(var e=this._events,n=e.length,t=0;n>t;t++){var o=e[t];o.selector?o.element.off(o.event,o.selector):o.element.off(o.event)}e.length=0},function(e,n){return new o(e,n)}});