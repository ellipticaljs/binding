!function(n,e){"undefined"!=typeof module&&module.exports?module.exports=e(require("elliptical-utils"),require("dustjs")):"function"==typeof define&&define.amd?define(["elliptical-utils","dustjs"],e):(n.elliptical=n.elliptical||{},n.elliptical.binding=e(n.elliptical.utils,n.dust),n.returnExports=n.elliptical.binding)}(this,function(n,e){function t(){$(document).on("OnDocumentMutation",function(n,e){e.added&&i(e.added),e.removed&&r(e.removed)})}function o(n,e){p||t(),p=!0;var o=g.obj;o.fn=e,o.context=this,h.set(n,o),this.click="touchclick",this._events=[]}function i(n){h.forEach(function(e,t){var o=$(n).selfFind("["+d+'="'+t+'"]');o[0]&&$.each(o,function(n,o){var i=f.id(8);o._EA_BINDING_ID=i;var r=y.obj;r.node=o,r.context=e.context,r.attrValue=t,r.fn=e.fn,m.set(i,r),l(e.context,o,e.fn)})})}function l(n,e,t){setTimeout(function(){t.call(n,e)},v)}function r(n){var e=$(n).selfFind(s);e.length&&e.length>0&&$.each(e,function(n,e){e._EA_BINDING_ID&&c(e)})}function c(n){var e=n._EA_BINDING_ID,t=m.get(e);void 0===t?a(n):u(t,n)}function u(n,e){n.context.unbindEvents(),n.context.onDestroy(),n.context=null,e&&e.parentNode&&e.parentNode.removeChild(e),n.fn=null,n.node=null,m["delete"](key)}function a(n){m.forEach(function(e,t){n===t.node&&u(t,n)})}var f=n.random,s="[ea-bind]",d="ea-bind",p=!1,v=500,h=new Map,m=new Map,g={get obj(){return{fn:null,context:null}}},y={get obj(){return{node:null,context:null,fn:null,attrValue:null}}};return $(function(){var n=document.querySelectorAll(s);n.length&&i(n)}),o.prototype.jsonParseMessage=function(n){try{var e=JSON.parse(n);return e.message?e.message:n}catch(t){return n}},o.prototype.render=function(n,t,o,i){"string"==typeof n&&(t=n,o=t,n=null),e.render(t,o,function(e,t){!e&&n&&n.html(t),i&&i(e,t)})},o.prototype.renderTemplate=function(n,t,o){e.render(n,t,function(n,e){n||(e=$.parseHTML(e,document,!0)),o&&o(n,e)})},o.prototype.preload=function(n,e){var t=[],o={},i=$(n),l=i.find("img"),r=l.length,c=0;return 0===r?(e&&e(null),!1):($.each(l,function(n,i){var l=new Image;$(l).bind("load",function(n){c++,t.push(l),c===r&&e&&(o.images=t,o.length=c,e(o))}),l.src=i.src}),!0)},o.prototype.load=function(n,e){var t=new Image;t.onload=function(){e(this)},t.src=n},o.prototype.component=function(n,e,t){if(n[e])return t(n[e].bind(n));var o=0,i=20,l=setInterval(function(){n[e]?(clearInterval(l),t(n[e].bind(n))):i>o?o++:(clearInterval(l),t(n[e].bind(n)))},300)},o.prototype.onDestroy=function(){},o.prototype.event=function(n,e,t,o){var i={};i.element=n,i.event=e;var l=arguments.length;3===l&&(o="function"==typeof t?t:null,t=null),i.selector=t,i.callback=o;var r=this._events;-1===$.inArray(i,r)&&this._events.push(i),t?n.on(e,t,function(){var n=[].slice.call(arguments);o&&o.apply(this,n)}):n.on(e,function(){var n=[].slice.call(arguments);o&&o.apply(this,n)})},o.prototype.unbindEvents=function(){for(var n=this._events,e=n.length,t=0;e>t;t++){var o=n[t];o.selector?o.element.off(o.event,o.selector):o.element.off(o.event)}n.length=0},function(n,e){return new o(n,e)}});