!function(e,n){"undefined"!=typeof module&&module.exports?module.exports=n(require("elliptical-utils"),require("component-extensions").template):"function"==typeof define&&define.amd?define(["elliptical-utils","component-extensions"],n):(e.elliptical=e.elliptical||{},e.elliptical.binding=n(e.elliptical.utils,elliptical.extensions.template),e.returnExports=e.elliptical.binding)}(this,function(e,n){function t(){$(document).on("OnDocumentMutation",function(e,n){n.added&&i(n.added),n.removed&&r(n.removed)})}function o(e,n){d||t(),d=!0;var o=y.obj;o.fn=n,o.context=this,h.set(e,o),this.click="touchclick",this._events=[]}function i(e){h.forEach(function(n,t){var o=$(e).selfFind("["+p+'="'+t+'"]');o[0]&&$.each(o,function(e,o){var i=f.id(8);o._EA_BINDING_ID=i;var r=b.obj;r.node=o,r.context=n.context,r.attrValue=t,r.fn=n.fn,g.set(i,r),l(n.context,o,n.fn)})})}function l(e,n,t){setTimeout(function(){t.call(e,n)},m)}function r(e){var n=$(e).selfFind(s);n.length&&n.length>0&&$.each(n,function(e,n){n._EA_BINDING_ID&&c(n)})}function c(e){var n=e._EA_BINDING_ID,t=g.get(n);void 0===t?a(e):u(t,e)}function u(e,n){e.context.unbindEvents(),e.context.onDestroy(),e.context=null,n&&n.parentNode&&n.parentNode.removeChild(n),e.fn=null,e.node=null,g["delete"](key)}function a(e){g.forEach(function(n,t){e===t.node&&u(t,e)})}n.template&&(n=n.template);var f=e.random,s="[ea-bind]",p="ea-bind",d=!1,m=500,v=250,h=new Map,g=new Map,y={get obj(){return{fn:null,context:null}}},b={get obj(){return{node:null,context:null,fn:null,attrValue:null}}};return $(function(){var e=document.querySelectorAll(s);e.length&&setTimeout(function(){i(e)},v)}),o.prototype.jsonParseMessage=function(e){try{var n=JSON.parse(e);return n.message?n.message:e}catch(t){return e}},o.prototype.render=function(e,t,o,i){n._render(e,t,o,i)},o.prototype.renderTemplate=function(e,t,o){n._renderTemplate(e,t,function(e,n){e||(n=$.parseHTML(n,document,!0)),o&&o(e,n)})},o.prototype.renderTemplateString=function(e,t,o){n._renderTemplateString(e,t,o)},o.prototype.preload=function(e,n){var t=[],o={},i=$(e),l=i.find("img"),r=l.length,c=0;return 0===r?(n&&n(null),!1):($.each(l,function(e,i){var l=new Image;$(l).bind("load",function(e){c++,t.push(l),c===r&&n&&(o.images=t,o.length=c,n(o))}),l.src=i.src}),!0)},o.prototype.load=function(e,n){var t=new Image;t.onload=function(){n(this)},t.src=e},o.prototype.component=function(e,n,t){if(e[n])return t(e[n].bind(e));var o=0,i=20,l=setInterval(function(){e[n]?(clearInterval(l),t(e[n].bind(e))):i>o?o++:(clearInterval(l),t(e[n].bind(e)))},300)},o.prototype.onDestroy=function(){},o.prototype.event=function(e,n,t,o){var i={};i.element=e,i.event=n;var l=arguments.length;3===l&&(o="function"==typeof t?t:null,t=null),i.selector=t,i.callback=o;var r=this._events;-1===$.inArray(i,r)&&this._events.push(i),t?e.on(n,t,function(){var e=[].slice.call(arguments);o&&o.apply(this,e)}):e.on(n,function(){var e=[].slice.call(arguments);o&&o.apply(this,e)})},o.prototype.unbindEvents=function(){for(var e=this._events,n=e.length,t=0;n>t;t++){var o=e[t];o.selector?o.element.off(o.event,o.selector):o.element.off(o.event)}e.length=0},function(e,n){return new o(e,n)}});