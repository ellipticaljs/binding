!function(n,t){"undefined"!=typeof module&&module.exports?module.exports=t(require("elliptical-utils"),require("dustjs"),require("elliptical-mutation-summary")):"function"==typeof define&&define.amd?define(["elliptical-utils","dustjs","elliptical-mutation-summary"],t):(n.elliptical=n.elliptical||{},n.elliptical.binding=t(n.elliptical.utils,n.dust,n.elliptical.mutation.summary),n.returnExports=n.elliptical.binding)}(this,function(n,t,e){function o(){$(document).on("OnDocumentMutation",function(n,t){t.added&&u(t.added),t.removed&&f(t.removed)})}function i(n,t){g||o(),g=!0;var e=x.obj;e.fn=t,e.context=this,I.set(n,e),this.click="touchclick",this._events=[]}function l(n,e){n=n.replace(/&quot;/g,'"');var o=t.compile(n,e);t.loadSource(o)}function r(n,e,o,i){t.render(e,o,function(t,e){(e||""===e)&&(n.innerHTML=e),i&&i(t,e)})}function c(n,t,e,o){var i="template-"+v.str(6);l(t,i),r(n,i,e,o)}function u(n){I.forEach(function(t,e){var o=$(n).selfFind("["+h+'="'+e+'"]');o[0]&&$.each(o,function(n,o){var i=v.id(8);o._EA_BINDING_ID=i;var l=j.obj;l.node=o,l.context=t.context,l.attrValue=e,l.fn=t.fn,_.set(i,l),a(t.context,o,t.fn)})})}function a(n,t,e){setTimeout(function(){e.call(n,t)},y)}function f(n){var t=$(n).selfFind(m);t.length&&t.length>0&&$.each(t,function(n,t){t._EA_BINDING_ID&&s(t)})}function s(n){var t=n._EA_BINDING_ID,e=_.get(t);void 0===e?p(n):d(e,n,t)}function d(n,t,e){n.context.unbindEvents(),n.context.onDestroy(),n.context=null,t&&t.parentNode&&t.parentNode.removeChild(t),n.fn=null,n.node=null,_["delete"](e)}function p(n){_.forEach(function(t,e){n===e.node&&d(e,n,t)})}var v=n.random,m="[ea-bind]",h="ea-bind",g=!1,y=500,b=250,I=new Map,_=new Map;e.connect();var x={get obj(){return{fn:null,context:null}}},j={get obj(){return{node:null,context:null,fn:null,attrValue:null}}};return $(function(){var n=document.querySelectorAll(m);n.length&&setTimeout(function(){u(n)},b)}),i.prototype.jsonParseMessage=function(n){try{var t=JSON.parse(n);return t.message?t.message:n}catch(e){return n}},i.prototype.render=function(n,t,e,o){c(n,t,e,o)},i.prototype.preload=function(n,t){var e=[],o={},i=$(n),l=i.find("img"),r=l.length,c=0;return 0===r?(t&&t(null),!1):($.each(l,function(n,i){var l=new Image;$(l).bind("load",function(n){c++,e.push(l),c===r&&t&&(o.images=e,o.length=c,t(o))}),l.src=i.src}),!0)},i.prototype.load=function(n,t){var e=new Image;e.onload=function(){t(this)},e.src=n},i.prototype.component=function(n,t,e){if(n[t])return e(n[t].bind(n));var o=0,i=20,l=setInterval(function(){n[t]?(clearInterval(l),e(n[t].bind(n))):i>o?o++:(clearInterval(l),e(n[t].bind(n)))},300)},i.prototype.onDestroy=function(){},i.prototype.event=function(n,t,e,o){var i={};i.element=n,i.event=t;var l=arguments.length;3===l&&(o="function"==typeof e?e:null,e=null),i.selector=e,i.callback=o;var r=this._events;-1===$.inArray(i,r)&&this._events.push(i),e?n.on(t,e,function(){var n=[].slice.call(arguments);o&&o.apply(this,n)}):n.on(t,function(){var n=[].slice.call(arguments);o&&o.apply(this,n)})},i.prototype.unbindEvents=function(){for(var n=this._events,t=n.length,e=0;t>e;e++){var o=n[e];o.selector?o.element.off(o.event,o.selector):o.element.off(o.event)}n.length=0},function(n,t){return new i(n,t)}});