!function(e,n){"undefined"!=typeof module&&module.exports?module.exports=n(require("elliptical-utils"),require("elliptical-template"),require("elliptical-mutation-summary")):"function"==typeof define&&define.amd?define(["elliptical-utils","elliptical-template","elliptical-mutation-summary"],n):(e.elliptical=e.elliptical||{},e.elliptical.binding=n(e.elliptical.utils,e.elliptical.$Template,e.elliptical.mutation.summary),e.returnExports=e.elliptical.binding)}(this,function(e,n,t){function o(){$(document).on("OnDocumentMutation",function(e,n){n.added&&a(n.added),n.removed&&p(n.removed)})}function i(e,n){y||o(),y=!0;var t=I.obj;t.fn=n,t.context=this,x.set(e,t),this.click="touchclick",this._events=[]}function r(e,t){var o=n.$provider;e=e.replace(/&quot;/g,'"');var i=dust.compile(e,t);o.loadSource(i)}function l(e,t,o,i){var r=n.$provider;r.render(t,o,function(n,t){(t||""===t)&&(e.innerHTML=t),i&&i(n,t)})}function c(e,n,t,o){var i="template-"+v.str(6);r(n,i),l(e,i,t,o)}function u(e){return document.createElement(e).constructor!==HTMLElement}function a(e){x.forEach(function(n,t){var o=$(e).selfFind("["+g+'="'+t+'"]');o[0]&&$.each(o,function(e,o){var i=v.id(8);o._EA_BINDING_ID=i;var r=M.obj;r.node=o,r.context=n.context,r.attrValue=t,r.fn=n.fn,E.set(i,r),f(n.context,o,n.fn)})})}function f(e,n,t){setTimeout(function(){t.call(e,n)},b)}function p(e){var n=$(e).selfFind(h);n.length&&n.length>0&&$.each(n,function(e,n){n._EA_BINDING_ID&&s(n)})}function s(e){var n=e._EA_BINDING_ID,t=E.get(n);void 0===t?m(e):d(t,e,n)}function d(e,n,t){e.context.unbindEvents(),e.context.dispose(),e.context=null,n&&n.parentNode&&n.parentNode.removeChild(n),e.fn=null,e.node=null,E["delete"](t)}function m(e){E.forEach(function(n,t){e===t.node&&d(t,e,n)})}var v=e.random,h="[ea-bind]",g="ea-bind",y=!1,b=500,_=250,w="scroll.infinite",x=new Map,E=new Map;t.connect();var I={get obj(){return{fn:null,context:null}}},M={get obj(){return{node:null,context:null,fn:null,attrValue:null}}};return $(function(){var e=document.querySelectorAll(h);e.length&&setTimeout(function(){a(e)},_)}),i.prototype.jsonParseMessage=function(e){try{var n=JSON.parse(e);return n.message?n.message:e}catch(t){return e}},i.prototype.renderString=function(e,n,t,o){c(e,n,t,o)},i.prototype.template=function(e,t,o){n.render(e,t,function(e,n){o&&o(e,n)})},i.prototype.render=function(e,t,o,i){n.render(t,o,function(n,t){n||(e.innerHTML=t),i&&i(n,t)})},i.prototype.append=function(e,t,o,i){n.render(t,o,function(n,t){var o;n||(o=$.parseHTML(t),$(e).append(o)),i&&i(n,o)})},i.prototype.prepend=function(e,t,o,i){n.render(t,o,function(n,t){var o;n||(o=$.parseHTML(t),$(e).prepend(o)),i&&i(n,o)})},i.prototype.onScroll=function(e){var n=function(){$(window).scrollTop()==$(document).height()-$(window).height()&&e&&e()},t=function(){window.requestAnimationFrame(n)};this.event($(window),w,t)},i.prototype.scrollOff=function(){for(var e=this._events,n=e.length,t=0;n>t;t++){var o=e[t];if(o.event===w){o.selector?o.element.off(o.event,o.selector):o.element.off(o.event),e.splice(t);break}}},i.prototype.preload=function(e,n){var t=[],o={},i=$(e),r=i.find("img"),l=r.length,c=0;return 0===l?(n&&n(null),!1):($.each(r,function(e,i){var r=new Image;$(r).bind("load",function(e){c++,t.push(r),c===l&&n&&(o.images=t,o.length=c,n(o))}),r.src=i.src}),!0)},i.prototype.load=function(e,n){var t=new Image;t.onload=function(){n(this)},t.src=e},i.prototype.register=function(e){e.length&&e.forEach(function(e){u(e)||document.registerElement(e)})},i.prototype.event=function(e,n,t,o){var i={};i.element=e,i.event=n;var r=arguments.length;3===r&&(o="function"==typeof t?t:null,t=null),i.selector=t,i.callback=o;var l=this._events;-1===$.inArray(i,l)&&this._events.push(i),t?e.on(n,t,function(){var e=[].slice.call(arguments);o&&o.apply(this,e)}):e.on(n,function(){var e=[].slice.call(arguments);o&&o.apply(this,e)})},i.prototype.unbindEvents=function(){for(var e=this._events,n=e.length,t=0;n>t;t++){var o=e[t];o.selector?o.element.off(o.event,o.selector):o.element.off(o.event)}e.length=0},i.prototype.dispose=function(){},function(e,n){return new i(e,n)}});